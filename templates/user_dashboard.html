<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - BubbleFlow</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='user_dashboard.css') }}">
</head>
<body>

<!-- Background Bubbles -->
<div class="bubble" style="width:100px;height:100px;left:5%;top:15%;"></div>
<div class="bubble" style="width:150px;height:150px;right:10%;top:5%;"></div>
<div class="bubble" style="width:80px;height:80px;left:20%;bottom:20%;"></div>
<div class="bubble" style="width:120px;height:120px;right:15%;bottom:10%;"></div>

<!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-light py-3 sticky-top">
    <div class="container">
        <a class="navbar-brand fw-bold fs-3" href="{{ url_for('user_dashboard') }}">
            <i class="fas fa-droplet text-primary me-2"></i> BubbleFlow
        </a>

        <div class="d-flex align-items-center gap-3">
            <div>
                <div class="fw-bold">{{ session.user.name }}</div>
                <div class="text-muted small">Customer</div>
            </div>
            <div class="vr"></div>
            <!-- ADDED EDIT PROFILE BUTTON HERE -->
            <a href="{{ url_for('edit_profile') }}" class="btn btn-link text-decoration-none text-dark">
                <i class="fas fa-user-edit me-1"></i> Edit Profile
            </a>
            <a href="{{ url_for('my_orders') }}" class="btn btn-link text-dark">
                <i class="fas fa-history me-1"></i> My Orders
            </a>
            <a href="javascript:void(0)" class="logout-btn" onclick="confirmLogout()">
            Logout
            </a>
        </div>
    </div>
</nav>

<main class="container py-4">

<!-- Welcome -->
<div class="welcome-section mb-5">
    <h1 class="fw-bold">
        Welcome, <span class="text-primary">{{ session.user.name.split(' ')[0] }}</span>!
    </h1>
    <p class="text-muted">Submit your laundry request below.</p>
</div>

<div class="row g-4">

<!-- Laundry Form -->
<div class="col-lg-7">
<div class="dashboard-card p-4">

<form method="POST" action="{{ url_for('submit_order') }}" id="laundryForm">

<!-- Weight -->
<div class="mb-4">
<label class="form-label fw-semibold">Laundry Weight (kg)</label>
<input type="number" class="form-control form-control-lg"
       id="weightInput" name="weight" min="0.1" step="0.1"
       oninput="calculateEstimate()" required>
</div>

<!-- Services -->
<label class="form-label fw-semibold">Select Services</label>
<div class="row g-3 align-items-stretch" id="servicesContainer">

{% for service in services %}
<div class="col-md-4">
<label class="service-option">
    <input type="checkbox"
           name="services"
           value="{{ service.service_id }}"
           data-price="{{ service.price_per_kg }}">

    <div class="service-icon">
        <i class="fas fa-star fa-2x text-primary"></i>
    </div>

    <h5>{{ service.service_name }}</h5>
    <div class="price-tag-small">₱{{ service.price_per_kg }}/kg</div>
    <div class="service-description">{{ service.description }}</div>
</label>
</div>
{% endfor %}

</div>

<!-- Estimate -->
<div class="mt-4 d-flex justify-content-between align-items-center">
<h5 class="fw-bold">Estimated Cost</h5>
<div class="price-tag" id="estimatedCost">₱0.00</div>
</div>

<button type="submit" class="btn btn-primary btn-lg w-100 mt-4">
Submit Laundry Request
</button>

</form>
</div>
</div>

<!-- Right Panel -->
<div class="col-lg-5">
<div class="dashboard-card p-4">
<h5 class="fw-bold">Recent Orders</h5>

{% if recent_orders %}
{% for order in recent_orders %}
<div class="border-bottom py-2">
<div class="fw-bold">Order #{{ order.order_id }}</div>
<div class="small text-muted">{{ order.weight }}kg • {{ order.service_names }}</div>
</div>
{% endfor %}
{% else %}
<p class="text-muted text-center">No orders yet</p>
{% endif %}
</div>
</div>

</div>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
/* Service selection logic (FIXED) */
document.querySelectorAll('.service-option').forEach(option => {
    const checkbox = option.querySelector('input[type="checkbox"]');

    option.addEventListener('click', () => {
        checkbox.checked = !checkbox.checked;
        option.classList.toggle('selected', checkbox.checked);
        calculateEstimate();
    });
});

/* Estimate */
function calculateEstimate() {
    const weight = parseFloat(document.getElementById('weightInput').value) || 0;
    let total = 0;

    document.querySelectorAll('input[name="services"]:checked').forEach(cb => {
        total += weight * parseFloat(cb.dataset.price);
    });

    document.getElementById('estimatedCost').textContent = '₱' + total.toFixed(2);
}

/* Form validation */
document.getElementById('laundryForm').addEventListener('submit', e => {
    if (!document.querySelector('input[name="services"]:checked')) {
        e.preventDefault();
        Swal.fire('Select a service', 'Please select at least one service.', 'warning');
    }
});
</script>
<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
function confirmLogout() {
  Swal.fire({
    title: 'Are you sure?',
    text: 'You will be logged out.',
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#dc3545',
    cancelButtonColor: '#6c757d',
    confirmButtonText: 'Yes, logout',
    cancelButtonText: 'Cancel'
  }).then((result) => {
    if (result.isConfirmed) {
      window.location.href = "{{ url_for('logout') }}";
    }
  });
}
</script>
</body>

</body>
</html>