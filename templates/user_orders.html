<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Orders - BubbleFlow</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/static/user_dashboard.css" />
  </head>
  <body>
    <!-- Background Bubbles -->
    <div
      class="bubble"
      style="
        width: 100px;
        height: 100px;
        left: 5%;
        top: 15%;
        animation-delay: 0s;
      "
    ></div>
    <div
      class="bubble"
      style="
        width: 150px;
        height: 150px;
        right: 10%;
        top: 5%;
        animation-delay: 1s;
      "
    ></div>
    <div
      class="bubble"
      style="
        width: 80px;
        height: 80px;
        left: 20%;
        bottom: 20%;
        animation-delay: 2s;
      "
    ></div>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light py-3 sticky-top">
      <div class="container">
        <a
          class="navbar-brand d-flex align-items-center fw-bold fs-3"
          href="{{ url_for('user_dashboard') }}"
        >
          <i class="fas fa-droplet text-primary me-2"></i> BubbleFlow
        </a>
        <div class="d-flex align-items-center gap-3">
          <div class="d-flex align-items-center">
            <div class="bg-primary bg-opacity-10 rounded-circle p-2 me-2">
              <i class="fas fa-user text-primary"></i>
            </div>
            <div>
              <div class="fw-bold">{{ session.user.name }}</div>
              <div class="text-muted small">Customer</div>
            </div>
          </div>
          <div class="vr"></div>
          <a
            href="{{ url_for('user_dashboard') }}"
            class="btn btn-link text-decoration-none text-dark"
          >
            <i class="fas fa-plus me-1"></i> New Request
          </a>
          <a href="javascript:void(0)" class="logout-btn" onclick="confirmLogout()">
            Logout
          </a>

        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="container py-4">
      <!-- Header -->
      <div class="d-flex justify-content-between align-items-center mb-5">
        <div>
          <h1 class="display-5 fw-bold mb-2">My Orders</h1>
          <p class="text-muted mb-0">
            Track your laundry requests and payment status
          </p>
        </div>
        <a
          href="{{ url_for('user_dashboard') }}"
          class="btn btn-primary rounded-pill px-4"
        >
          <i class="fas fa-plus me-2"></i> New Request
        </a>
      </div>

      <!-- Stats Summary -->
      <div class="dashboard-summary mb-5">
        <div class="dashboard-card text-center">
          <div class="text-primary fw-bold fs-2 mb-1">{{ total_orders }}</div>
          <div class="text-muted">Total Orders</div>
        </div>

        <div class="dashboard-card text-center">
          <div class="text-warning fw-bold fs-2 mb-1">{{ pending_orders }}</div>
          <div class="text-muted">Pending</div>
        </div>

        <div class="dashboard-card text-center">
          <div class="text-info fw-bold fs-2 mb-1">
            {{ in_progress_orders }}
          </div>
          <div class="text-muted">In Progress</div>
        </div>

        <div class="dashboard-card text-center">
          <div class="text-ready fw-bold fs-2 mb-1">{{ ready_orders }}</div>
          <div class="text-muted">Ready</div>
        </div>

        <div class="dashboard-card text-center">
          <div class="text-success fw-bold fs-2 mb-1">
            {{ completed_orders }}
          </div>
          <div class="text-muted">Completed</div>
        </div>
      </div>

      <!-- Orders List -->
      <div class="dashboard-card p-4">
        {% if orders %}
        <div class="table-responsive">
          <table class="table table-hover align-middle">
            <thead class="table-light">
              <tr>
                <th>Order ID</th>
                <th>Date</th>
                <th>Weight</th>
                <th>Services</th>
                <th>Total</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for order in orders %}
              <tr class="order-card">
                <td>
                  <div class="fw-bold">#{{ order.order_id }}</div>
                  <div class="text-muted small">{{ order.order_code }}</div>
                </td>
                <td>
                  <div class="fw-semibold">
                    {{ order.created_at.strftime('%b %d, %Y') }}
                  </div>
                  <div class="text-muted small">
                    {{ order.created_at.strftime('%I:%M %p') }}
                  </div>
                </td>
                <td>
                  <div class="d-flex align-items-center">
                    <i class="fas fa-weight-scale text-primary me-2"></i>
                    <span class="fw-semibold">{{ order.weight }} kg</span>
                  </div>
                </td>
                <td>
                  <div class="d-flex flex-wrap gap-1">
                    {% for service in order.services_list %}
                    <span class="badge bg-primary bg-opacity-10 text-primary">
                      {{ service }}
                    </span>
                    {% endfor %}
                  </div>
                </td>
                <td class="fw-bold text-primary">
                  ₱{{ "%.2f"|format(order.total_estimate) }}
                </td>
                <td>
                  <span
                    class="status-badge status-{{ order.status|lower|replace(' ', '-') }}"
                  >
                    {{ order.status }}
                  </span>
                </td>
                <td>
                  <button
                    class="btn btn-sm btn-outline-primary"
                    onclick="showOrderDetails(this)"
                    data-id="{{ order.order_id }}"
                    data-date="{{ order.created_at.strftime('%B %d, %Y') }}"
                    data-time="{{ order.created_at.strftime('%I:%M %p') }}"
                    data-weight="{{ order.weight }}"
                    data-total="₱{{ '%.2f'|format(order.total_estimate) }}"
                    data-status="{{ order.status }}"
                    data-services="{{ order.services_list | join(',') }}"
                  >
                    <i class="fas fa-eye"></i> View
                  </button>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <!-- Pagination -->
        {% if total_pages > 1 %}
        <nav aria-label="Order pagination" class="mt-4">
          <ul class="pagination justify-content-center">
            {% if page > 1 %}
            <li class="page-item">
              <a class="page-link" href="?page={{ page-1 }}">Previous</a>
            </li>
            {% endif %} {% for p in range(1, total_pages + 1) %}
            <li class="page-item {% if p == page %}active{% endif %}">
              <a class="page-link" href="?page={{ p }}">{{ p }}</a>
            </li>
            {% endfor %} {% if page < total_pages %}
            <li class="page-item">
              <a class="page-link" href="?page={{ page+1 }}">Next</a>
            </li>
            {% endif %}
          </ul>
        </nav>
        {% endif %} {% else %}
        <!-- Empty State -->
        <div class="text-center py-5">
          <div class="mb-4">
            <i class="fas fa-inbox fa-4x text-muted opacity-25"></i>
          </div>
          <h4 class="fw-bold mb-3">No Orders Yet</h4>
          <p class="text-muted mb-4">
            You haven't submitted any laundry requests yet.
          </p>
          <a
            href="{{ url_for('user_dashboard') }}"
            class="btn btn-primary rounded-pill px-5"
          >
            <i class="fas fa-plus me-2"></i> Submit Your First Request
          </a>
        </div>
        {% endif %}
      </div>

      <!-- Order Details Modal -->
      <div class="modal fade" id="orderDetailsModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header border-0 pb-0">
              <h5 class="modal-title fw-bold">Order Details</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
              ></button>
            </div>
            <div class="modal-body">
              <div id="orderDetailsContent">
                <!-- Will be populated by JavaScript -->
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Payment Information -->
      <div class="dashboard-card p-4 mt-4">
        <div class="d-flex align-items-start">
          <div class="icon-box bg-primary text-white rounded-circle p-3 me-4">
            <i class="fas fa-credit-card fa-lg"></i>
          </div>
          <div>
            <h5 class="fw-bold mb-2">Payment Information</h5>
            <p class="text-muted mb-3">
              All payments are completed at our laundry shop. Please bring your
              order confirmation when dropping off your clothes.
            </p>
            <div class="row g-3">
              <div class="col-md-6">
                <div class="border rounded-3 p-3">
                  <h6 class="fw-bold mb-2">
                    <i class="fas fa-money-bill-wave text-success me-2"></i>Cash
                    Payment
                  </h6>
                  <p class="small text-muted mb-0">
                    Pay with cash when dropping off your laundry.
                  </p>
                </div>
              </div>
              <div class="col-md-6">
                <div class="border rounded-3 p-3">
                  <h6 class="fw-bold mb-2">
                    <i class="fas fa-mobile-alt text-primary me-2"></i>Digital
                    Payment
                  </h6>
                  <p class="small text-muted mb-0">
                    We accept GCash and PayMaya.
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="py-4 border-top mt-5">
      <div
        class="container d-flex flex-column flex-md-row justify-content-between align-items-center"
      >
        <div class="fw-bold fs-5">
          <i class="fas fa-droplet text-primary me-2"></i> BubbleFlow
        </div>
        <p class="text-muted small mb-0">
          © 2024 BubbleFlow. Fresh, Clean, Simple.
        </p>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
      function showOrderDetails(btn) {
        const order = {
          id: btn.dataset.id,
          date: btn.dataset.date,
          time: btn.dataset.time,
          weight: btn.dataset.weight,
          total: btn.dataset.total,
          status: btn.dataset.status,
          services: btn.dataset.services.split(","),
        };

        const servicesHTML = order.services
          .map(
            (s) =>
              `<span class="badge bg-primary bg-opacity-10 text-primary">${s}</span>`
          )
          .join(" ");

        document.getElementById("orderDetailsContent").innerHTML = `
    <div class="mb-3">
      <strong>Order #${order.id}</strong>
    </div>

    <p class="text-muted">${order.date} • ${order.time}</p>

    <div class="row g-3 mb-3">
      <div class="col-6">
        <div class="border rounded p-3">
          <small class="text-muted">Weight</small>
          <div class="fw-bold">${order.weight} kg</div>
        </div>
      </div>

      <div class="col-6">
        <div class="border rounded p-3">
          <small class="text-muted">Total</small>
          <div class="fw-bold text-primary">${order.total}</div>
        </div>
      </div>
    </div>

    <div class="mb-3">
      <small class="text-muted">Services</small><br>
      ${servicesHTML}
    </div>

    <div class="alert alert-info">
      Please bring a printed copy or show a screenshot of this receipt when picking up your laundry.
    </div>

    <button class="btn btn-primary"
      onclick="window.open('/order/${order.id}/receipt','_blank')">
      <i class="fas fa-print"></i> Print Receipt
    </button>
  `;

        new bootstrap.Modal(
          document.getElementById("orderDetailsModal")
        ).show();
      }
    </script>

    {% with messages = get_flashed_messages(with_categories=true) %} {% if
    messages %}
    <script>
      {% for category, message in messages %}
      Swal.fire({
          icon: '{{ "success" if category == "success" else "error" if category == "error" else "info" }}',
          title: '{{ "Success" if category == "success" else "Notice" }}',
          text: '{{ message }}',
          timer: 3000,
          showConfirmButton: false
      });
      {% endfor %}
    </script>
    {% endif %} {% endwith %}
    <!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
function confirmLogout() {
  Swal.fire({
    title: 'Are you sure?',
    text: 'You will be logged out.',
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#dc3545',
    cancelButtonColor: '#6c757d',
    confirmButtonText: 'Yes, logout',
    cancelButtonText: 'Cancel'
  }).then((result) => {
    if (result.isConfirmed) {
      window.location.href = "{{ url_for('logout') }}";
    }
  });
}
</script>
</body>

  </body>
</html>
